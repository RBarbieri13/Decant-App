# Decant - AI-Powered Knowledge Curation Platform

**Note**: This is a completely redesigned version with Electron removed. The app now runs as a web-based Express.js + React application.

## Architecture Overview

Decant is now a full-stack web application:
- **Backend**: Node.js + Express.js
- **Database**: SQLite (stored at `~/.decant/data/decant.db`)
- **Frontend**: React with TypeScript
- **Build Tool**: Vite (frontend) + TypeScript (backend)

## Quick Start

### Development

```bash
# Install dependencies
npm install

# Start dev server with hot reload
npm run dev
```

Server runs on **http://localhost:3000**

### Production

```bash
# Build React frontend + compile backend
npm run build

# Start production server
npm start
```

## Project Structure

```
src/
├── backend/
│   ├── database/
│   │   ├── connection.ts      # SQLite connection setup
│   │   ├── schema.ts          # Database schema and initialization
│   │   ├── nodes.ts           # Node CRUD operations
│   │   ├── taxonomy.ts        # Segments & Organizations
│   │   ├── search.ts          # Full-text search
│   │   └── index.ts           # Exports
│   └── routes/
│       ├── index.ts           # Route registration
│       ├── nodes.ts           # Node endpoints
│       ├── hierarchy.ts       # Hierarchy endpoints
│       └── search.ts          # Search endpoints
├── renderer/
│   ├── App.tsx                # Root component
│   ├── renderer.tsx           # React mount point
│   ├── components/
│   │   ├── layout/            # Layout components (AppShell, TreePanel, etc.)
│   │   ├── import/            # Import dialog
│   │   ├── search/            # Search functionality
│   │   └── dialogs/           # Modal dialogs
│   ├── context/
│   │   └── AppContext.tsx     # Global state management (React Context)
│   ├── services/
│   │   └── api.ts             # HTTP client for backend API
│   └── styles/                # CSS files
├── shared/
│   ├── constants.ts           # Shared constants
│   └── types.ts               # Shared TypeScript types
├── server.ts                  # Express.js entry point
└── renderer.tsx               # React entry point

dist/                          # Built artifacts (generated by npm run build)
```

## API Endpoints

### Nodes
- `GET /api/nodes` - Get all nodes
- `GET /api/nodes/:id` - Get node by ID
- `POST /api/nodes` - Create new node
- `PUT /api/nodes/:id` - Update node
- `DELETE /api/nodes/:id` - Delete node (soft delete)

### Hierarchy
- `GET /api/hierarchy/tree/:view` - Get hierarchy tree (view: "function" or "organization")
- `GET /api/hierarchy/segments` - Get all segments (Functional taxonomy)
- `GET /api/hierarchy/organizations` - Get all organizations (Organizational taxonomy)

### Search
- `GET /api/search?q=query` - Search nodes by query string

## Database Schema

### Tables
- **nodes**: Core nodes with all descriptor fields
- **key_concepts**: Tags associated with nodes
- **segments**: Functional taxonomy categories
- **organizations**: Organizational taxonomy categories

### Key Node Fields
- `id`: UUID primary key
- `title`: Node title/headline
- `url`: Original URL
- `source_domain`: Extracted domain
- `date_added`: Import timestamp
- `company`: Organization that created content
- `phrase_description`: 100-char tagline
- `short_description`: 1-3 sentence summary
- `logo_url`: Logo/favicon URL
- `ai_summary`: AI-generated summary
- `extracted_fields`: JSON metadata
- `metadata_tags`: Array of tags
- `key_concepts`: Array of concept tags (via key_concepts table)
- `function_parent_id`: Parent in functional hierarchy
- `organization_parent_id`: Parent in organizational hierarchy
- `is_deleted`: Soft delete flag

## Development

### Available Scripts

- `npm run dev` - Start dev server with hot reload
- `npm run build` - Build React frontend and compile backend
- `npm start` - Run production build
- `npm run preview` - Preview production build locally

### Key Technologies

- **React 18**: UI framework
- **TypeScript**: Type-safe development
- **Express.js**: HTTP server
- **SQLite**: Lightweight database
- **Vite**: Fast frontend bundling
- **better-sqlite3**: Synchronous SQLite bindings

## Current Status

### ✅ Implemented
- Express.js backend server
- SQLite database with schema
- REST API for CRUD operations
- React frontend with context-based state management
- Hierarchy views (Function & Organization)
- Search functionality
- Settings storage (localStorage)
- Node CRUD operations

### ⏳ Not Yet Implemented
- URL import pipeline (scraping, AI classification)
- AI-powered auto-categorization
- Web content extraction
- Merge functionality
- Context menu operations
- Drag-and-drop tree reorganization

## Database Location

SQLite database is stored at:
```
~/.decant/data/decant.db
```

This ensures data persists between sessions and is stored in a standard user data location.

## Notes for Development

- The app now requires Node.js 18+ (for ES modules support)
- better-sqlite3 is a native module - may need rebuilding if Node version changes
- Frontend is built separately with Vite and served as static files from `/dist`
- Backend runs the Express server and serves the React frontend

## Recent Changes (v0.2.0)

- ✅ Removed Electron completely
- ✅ Migrated to Express.js + Node.js
- ✅ Converted IPC communication to REST API
- ✅ Updated frontend to use fetch API
- ✅ Streamlined dependencies (934 → 208 packages)
- ✅ Implemented SQLite database layer
- ✅ Added REST API endpoints

---

For the complete specification, see [DECANT_MASTER_SPECIFICATION.md](./DECANT_MASTER_SPECIFICATION.md)
